%%
%% This file contains the code that is common for Caesar-article and Caesar-book 2011-08-17 (OS-AT)

\ProvidesFile{caesar.def}[2011/08/17 v0.0.1 Common code for the Caesar styles]

%%
% The `keyval' package simplifies the user interface for the document class options
\RequirePackage{keyval}

%%
% We use the `ifthen' package to handle our package option switches
\RequirePackage{ifthen}

\RequirePackage{marginnote}
\RequirePackage{caption}
\RequirePackage{sidenotes}

\AtBeginDocument{\usepackage{changepage}}

%%
% `scroll' option

\newboolean{@caesar@scroll}
\setboolean{@caesar@scroll}{false}
\DeclareOption{scroll}{\setboolean{@caesar@scroll}{true}}%

%\ExecuteOptions{}
\ProcessOptions\relax

%%
% Set page layout geometry

\RequirePackage[paperwidth=170mm, paperheight=240mm, left=40pt, top=40pt, textwidth=280pt, marginparsep=20pt, marginparwidth=100pt, textheight=560pt, footskip=40pt]{geometry}

\ifthenelse{\boolean{@caesar@scroll}}
  {\geometry{paperwidth=170mm, paperheight=16383pt, left=40pt, top=40pt, textwidth=280pt, marginparsep=20pt, marginparwidth=100pt, textheight=16263pt, footskip=40pt}}
  {}
  
\ifthenelse{\boolean{@caesar@scroll}}{\setcounter{totalnumber}{100}}

% load fonts 
\usepackage{fontspec}
% Use the Palatino-Clone Tex Gyre Pagella as main font
\usepackage{mathpazo}
\setmainfont[Ligatures=TeX, Scale=1, Numbers=OldStyle]{Tex Gyre Pagella}
%\setmainfont{Helvetica}
% Use Tex Gyre Cursor als Monospace Font
\setmonofont{Tex Gyre Cursor}
% Use Tex Gyre Heros Cn als Sans Serif Font
\setmonofont{Tex Gyre Heros Cn}
% fontsize is 10pt, 13pt 
\renewcommand{\normalsize}{\fontsize{10pt}{13pt}\selectfont} 

\setcounter{secnumdepth}{-1}
% Fonts for section headings
%\usepackage{titlesec,titletoc}
% Chapter
%\titleformat{\chapter}[display]{\normalfont\huge\itshape}{\thechapter}{1 em}{}
% Section
%\titleformat{\section}[hang]{\normalfont\Large\itshape}{\thesection}{1em}{}
%
\renewcommand{\chapter}{\@startsection
	{chapter}%				        % the name
	{0}%					      	% level
	{0pt}%					        % indention
	{-1\baselineskip}%			    % vertical distance to text before
	{1\baselineskip}%			    % Nachabstand
	{\normalfont\Large\itshape}}%	% format
	
\renewcommand{\section}{\@startsection
	{section}%                      % the name
	{0}%					      	% level
	{0pt}%					        % indention
	{-1\baselineskip}%		    	% vertical distance to text before
	{1\baselineskip}%		    	% Nachabstand
	{\normalfont\large\itshape}}%	% format


\usepackage{fancyhdr}
\fancypagestyle{plain}{% 
\fancyhf{} % clear all header and footer fields 
\fancyfoot[LE,RO]{\thepage}
\renewcommand{\headrulewidth}{0pt} 
\renewcommand{\footrulewidth}{0pt}
}
\pagestyle{plain}
%
\newcommand\newthought[1]{%
   \addvspace{1.0\baselineskip plus 0.5ex minus 0.2ex}%
   \noindent\textsc{#1}%
}

\renewcommand{\footnotesize}{\fontsize{8pt}{10pt}\selectfont} 
\DeclareCaptionJustification{raggedouter}{\raggedouter}
%\renewcommand{\marginnotevadjust}{2pt}
\captionsetup{width=\marginparwidth, justification=raggedouter, font=footnotesize, skip = 0pt}
\renewcommand{\sidestyle}{\footnotesize\raggedouter}

%%
% fullwidth environment

\newlength{\overhang}
\setlength{\overhang}{\marginparwidth}
\addtolength{\overhang}{\marginparsep}

\newenvironment{fullwidth}
	{\begin{adjustwidth*}{}{-\overhang}}%
	{\end{adjustwidth*}}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Author, titel and publisher
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage{xifthen}
\RequirePackage{color}
\definecolor{darkgray}{rgb}{0.25,0.25,0.25}

%%
% Produces a full title page

% Modified \title, \author, and \date commands.  These store the
% (footnote-less) values in \plaintitle, \plainauthor, and \thedate, respectively.

\newcommand{\plaintitle}{}%     plain-text-only title
\newcommand{\plainauthor}{}%    plain-text-only author
\newcommand{\plainpublisher}{}% plain-text-only publisher

\newcommand{\thanklesstitle}{}%     full title text minus \thanks{}
\newcommand{\thanklessauthor}{}%    full author text minus \thanks{}
\newcommand{\thanklesspublisher}{}% full publisher minus \thanks{}

\newcommand{\@publisher}{}% full publisher with \thanks{}
\newcommand{\thedate}{\today}

% TODO Fix it so that \thanks is not spaced out (with `soul') and can be
% used in \maketitle when the `sfsidenotes' option is provided.
\renewcommand{\thanks}[1]{\NoCaseChange{\footnote{#1}}}

\renewcommand{\title}[2][]{%
  \gdef\@title{#2}%
  \begingroup%
    % TODO store contents of \thanks command
    \renewcommand{\thanks}[1]{}% swallow \thanks contents
    \protected@xdef\thanklesstitle{#2}%
  \endgroup%
  \ifthenelse{\isempty{#1}}%
    {\renewcommand{\plaintitle}{\thanklesstitle}}% use thankless title
    {\renewcommand{\plaintitle}{#1}}% use provided plain-text title
  \ifthenelse{\isundefined{\hypersetup}}%
    {}% hyperref is not loaded; do nothing
    {\hypersetup{pdftitle={\plaintitle}}}% set the PDF metadata title
}

\let\@author\@empty% suppress default latex.ltx ``no author'' warning
\renewcommand{\author}[2][]{%
  \ifthenelse{\isempty{#2}}{}{\gdef\@author{#2}}%
  \begingroup%
    % TODO store contents of \thanks command
    \renewcommand{\thanks}[1]{}% swallow \thanks contents
    \protected@xdef\thanklessauthor{#2}%
  \endgroup%
  \ifthenelse{\isempty{#1}}%
    {\renewcommand{\plainauthor}{\thanklessauthor}}% use thankless author
    {\renewcommand{\plainauthor}{#1}}% use provided plain-text author
  \ifthenelse{\isundefined{\hypersetup}}%
    {}% hyperref is not loaded; do nothing
    {\hypersetup{pdfauthor={\plainauthor}}}% set the PDF metadata author
}

\renewcommand{\date}[1]{%
  \gdef\@date{#1}%
  \begingroup%
    % TODO store contents of \thanks command
    \renewcommand{\thanks}[1]{}% swallow \thanks contents
    \protected@xdef\thedate{#1}%
  \endgroup%
}

%%
% Provides a \publisher command to set the publisher

\newcommand{\publisher}[2][]{%
  \gdef\@publisher{#2}%
  \begingroup%
    \renewcommand{\thanks}[1]{}% swallow \thanks contents
    \protected@xdef\thanklesspublisher{#2}%
  \endgroup%
  \ifthenelse{\isempty{#1}}
    {\renewcommand{\plainpublisher}{\thanklesspublisher}}% use thankless publisher
    {\renewcommand{\plainpublisher}{#1}}% use provided plain-text publisher
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% designing the titlepage \maketitlepage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\DeclareTextFontCommand{\textsmallcaps}{\scshape}  % Wozu ist das n√∂tig?
 
\RequirePackage{textcase} % provides \MakeTextUppercase and \MakeTextLowercase
%\def\allcapsspacing{\@tufte@warning{Proper spacing of ALL-CAPS letters has not been set up.}}
%\def\smallcapsspacing{\@tufte@warning{Proper spacing of small-caps letters has not been set up.}}
\newcommand{\allcaps}{\MakeTextUppercase}
\newcommand{\smallcaps}{\MakeTextLowercase}

\newcommand{\maketitlepage}[0]{%
  \cleardoublepage%
  {%
  \sffamily%
  \begin{fullwidth}%
  \fontsize{18}{20}\selectfont\par\noindent\textcolor{darkgray}{\allcaps{\thanklessauthor}}%
  \vspace{11.5pc}%
  \fontsize{36}{40}\selectfont\par\noindent\textcolor{darkgray}{\allcaps{\thanklesstitle}}%
  \vfill%
  \fontsize{14}{16}\selectfont\par\noindent\allcaps{\thanklesspublisher}%
  \end{fullwidth}%
  }
  \thispagestyle{empty}%
  \clearpage%
}

% from here: redefenition of \maketitle
% again: the sf-option is left out
\renewcommand{\maketitle}{%
  \newpage%
  \global\@topnum\z@% prevent floats from being placed at the top of the page
  \begingroup%
    \setlength{\parindent}{0pt}%
    \setlength{\parskip}{4pt}%
    \let\@@title\@empty%
    \let\@@author\@empty%
    \let\@@date\@empty%
      \gdef\@@title{\Large\itshape\@title\par}%
      \gdef\@@author{\large\itshape\@author\par}%
      \gdef\@@date{\large\itshape\@date\par}%
    \@@title%
    \@@author%
    \@@date%
  \endgroup%
  \thispagestyle{plain}% suppress the running head
}